
* Introduction
This code adds resource id's into content of html files, takes 2 inputs:
1) Path to src folder that contains folders of labs with html files in them
2) Path to labspec.json file for corresponding lab
* Implementation
** imports
#+BEGIN_SRC python :tangle addIds.py
from bs4 import BeautifulSoup
from os import listdir
from os.path import isfile, join, splitext
import sys, json, re
#+END_SRC

** Handling Convention
#+BEGIN_SRC python :tangle addIds.py
def editName(name):
	name = name.lower()
	newName = re.sub(r'[^a-zA-Z0-9\s+-]', '', name)
	newName = newName.strip()
	finalName = re.sub('\s+', '-', newName)
	return finalName
#+END_SRC

** Insert Ids
Using BeautifulSoup a parse tree is obtained making it easy to search and
insert into the tree
#+BEGIN_SRC python :tangle addIds.py
def addHooks(files, expPath, labName, expName):
	for f in files:
		fileName, ext = splitext(f)
		if ext == '.html':
			ptree = BeautifulSoup(open(join(expPath, f)))
			headList = ptree.find_all(re.compile("^h[0-9]$"))
			for h in headList:
				h['id'] = labName + '-' + expName + '-' + fileName
			pList = ptree.find_all('p')
			for p in pList:
				p['id'] = labName + '-' + expName + '-' + fileName +'-content'	
			new_html_content = ptree.prettify()
			k = open(join(expPath,f), 'w+')
			k.write(new_html_content)
			k.close()

#+END_SRC

* Execution
#+BEGIN_SRC python :tangle addIds.py
if __name__ == '__main__':
	try:
		dirPath = sys.argv[1]
		jsonPath = sys.argv[2]
	except Exception as error:
		print('Error: '+str(error))
	with open(jsonPath) as data_file:
		data = json.load(data_file)
	exps = data.get('experiments')
	labName = data.get('course').get('display_name')
	labName = editName(labName)
	for i in exps:
		expName = i.get('name')
		expName = editName(expName)
		expPath = join(dirPath, expName)
		expName = editName(expName)
		onlyfiles = [f for f in listdir(expPath) if isfile(join(expPath, f))]
		addHooks(onlyfiles, expPath, labName, expName)
#+END_SRC
